#!/usr/bin/env bash

set -e

# === NORMAL / BRIGHT COLORS USED ===
b_red=$'\033[91m'       # merah terang
b_green=$'\033[92m'     # hijau terang
b_yellow=$'\033[93m'    # kuning terang
b_cyan=$'\033[96m'      # cyan terang
b_magenta=$'\033[95m'   # magenta terang
reset=$'\033[0m'        # reset color

# === GRADIENT COLORS USED ===
grad1=$'\033[38;5;39m'    # cyan biru muda
grad2=$'\033[38;5;63m'    # biru keungu
grad3=$'\033[38;5;99m'    # ungu lembut
grad6=$'\033[38;5;201m'   # pink magenta cerah (dipakai di ASCII ahegao)

# === INFO ===
detect_os() {
    local arch os
    arch=$(uname -m)
    os="UNKNOWN"

    case "$arch" in
        x86_64)
            if [[ -f /etc/os-release ]]; then
                source /etc/os-release
                os="$NAME"
            else
                os="UNKNOWN x86_64"
            fi
            ;;
        i686|i386)
            if [[ -f /etc/os-release ]]; then
                source /etc/os-release
                os="$NAME (32-bit)"
            else
                os="UNKNOWN 32-bit"
            fi
            ;;
        aarch64)
            os="Android/ARM64"
            ;;
        armv7l)
            os="Android/ARM32"
            ;;
        *)
            os="UNKNOWN"
            ;;
    esac

    echo "$os"
}

# === DETECT FIEMWARE AGE ===
hostname() {
    if ! command -v hostnamectl &>/dev/null; then
        fw_age="unknown"
    else
        fw_age="$(hostnamectl | grep "Firmware Age" | sed 's/.*Firmware Age: //')"
        
    fi
    echo "$fw_age"
}

# === OS AGE ===
get_os_age() {
    local install_date=""
    local then now days

    # Try get install date from FS birth
    install_date=$(stat -c %w / 2>/dev/null)
    if [[ "$install_date" == "-" || -z "$install_date" ]]; then
        install_date=""
    fi

    # Arch fallback
    if [[ -z "$install_date" && -f /var/log/pacman.log ]]; then
        install_date=$(awk -F'[][]' 'NR==1 {print $2}' /var/log/pacman.log | cut -d'T' -f1)
    fi

    # Debian/Ubuntu fallback
    if [[ -z "$install_date" && -d /var/log/installer ]]; then
        install_date=$(find /var/log/installer -type f -printf '%T@ %p\n' | sort -n | head -n1 | awk '{print $2}')
    fi

    # Convert to days
    if [[ -n "$install_date" ]]; then
        then=$(date -d "${install_date%%+*}" +%s 2>/dev/null || echo 0)
        now=$(date +%s)
        days=$(( (now - then) / 86400 ))
        (( days == 1 )) && echo "1 DAY" || echo "$days DAYS"
    else
        echo "unknown"
    fi
}

# === INFO ===
header="IUNO FETCH v0.1.0"
os="$(detect_os)"
user="$(whoami)"
memory_total="$(free -h | awk '/^Mem:/ {print $2}')"
memory_used="$(free -h | awk '/^Mem:/ {print $3}')"
percent="$(free | awk '/^Mem:/ {printf "%.0f%%", $3/$2 * 100}')"
memory="${memory_used} / ${memory_total} (${percent})" 
terminal="${TERM:-unknown}"
shell="$(basename "$SHELL")"
shell="$($shell --version | cut -d' ' -f1-2)"
kernel="$(uname -r)"
de_wm="${XDG_CURRENT_DESKTOP:-unknown}"
uptime="$(uptime -p | sed 's/^up //')"
os_age="$(get_os_age)"
fw_age="$(hostname)"

# === PRINT INFO ===
normal(){
cat <<-EOF
${b_magenta}                              $header
                   ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
${grad1}                     ${b_red}  user:${reset} $user
${grad1}                     ${b_cyan}  distro:${reset} $os 
${grad1}         /\          ${b_red}  terminal:${reset} $terminal
${grad1}        /  \         ${b_yellow}  shell:${reset} $shell $shell_version
${grad1}       /\   \        ${b_green}  kernel:${reset} $kernel
${grad1}      /      \       ${b_magenta} 󱗃 de/wm:${reset} $de_wm
${grad1}     /   ,,   \      ${grad2}  memory:${reset} $memory
${grad1}    /   |  |  -\      ${grad1}󱫐 uptime :${reset} $uptime
${grad1}   /_-''    ''-_\     ${grad2}󱦟 os age:${reset} $os_age
${grad1}                      ${b_yellow} fw age${reset}: $fw_age ${reset}
${grad3}                      I USE ARCH BTW!
${b_magenta}                   ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛

EOF
}

ahegao() {
    cat <<-EOF
${grad6}⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢿⣿⢿⣿⣿⣿⢿⣿⡇⣎⣿⣿⣿⣿⣿⡇⣿⡿⣷⣹⣿
${grad6}⣿⣿⣿⣿⡿⢿⣿⡿⣿⣿⣿⢿⣿⣿⣿⣿⣿⣿⣿⣷⣿⡎⡟⣻⡛⠿⢻⡇⣿⡘⣿⣿⣿⡟⣷⠹⣿⢹⣿⣿
${grad6}⣿⣿⣿⣿⣷⠸⣿⣇⢻⣿⠙⣡⠹⣿⣿⣿⣿⣿⣿⣿⣿⣿⣴⣿⢱⣷⢠⢨⢙⡃⠹⢿⣿⡇⣿⢧⢹⡇⣿⣿
${grad6}⣿⣿⣿⣿⡇⣇⢻⣿⠌⣠⣆⣿⣷⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⢇⣿⡟⣾⡘⣾⣷⠀⣷⣶⡄⢩⠙⣇⣻⣹⣿
${grad6}⢹⡝⣟⣿⣿⠯⠂⣡⣶⠘⣿⢹⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⡿⣾⡟⣆⡏⣸⠿⣻⣧⢹⣿⠃⠈⣿⡽⡘⣿⣿    ${b_red}  user:${reset} $user
${grad6}⠧⠷⠈⠩⣥⢸⣷⠘⣿⠀⠙⣧⢻⣿⣿⣿⣿⣿⣿⣿⣿⣿⢱⡟⠀⣸⢱⢗⡭⢶⣒⡐⡆⢨⢀⣋⠹⣧⢹⣿    ${b_cyan}  distro:${reset} $os 
${grad6}⣿⡈⢆⡐⠹⠌⠿⠷⡌⣧⠀⠙⣎⣿⣿⣿⣿⣿⣿⣿⣿⢇⡿⢡⠂⠇⣠⣽⢾⠟⠛⡁⠃⠍⠈⠉⠵⠆⠈⣿    ${b_red}  terminal:${reset} $terminal
${grad6}⡸⣇⠢⠈⣄⠲⠹⣷⣶⣈⠃⠱⡜⡜⢿⣿⣿⣿⣿⣿⣿⡸⠡⣱⠃⡸⠛⠉⠀⠈⠀⠀⠀⠀⠀⠀⠀⠀⠀⠰    ${b_yellow}  shell:${reset} $shell $shell_version
${grad6}⣷⠟⠐⠗⠘⢃⠁⠉⣛⡛⠧⡀⠘⣌⠈⣿⣿⣿⣿⣿⡏⢀⣵⡟⣰⣧⠄⢀⣠⡀⠀⣀⠲⠾⢠⠀⣰⣶⠀⢠    ${b_green}  kernel:${reset} $kernel
${grad6}⣿⣄⠃⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⢦⡈⢿⣿⣿⡿⠡⣖⢝⡳⣖⠤⣰⢿⣻⣭⣦⣬⣑⣂⣥⣾⡿⢃⣴⠘    ${b_magenta} 󱗃 de/wm:${reset} $de_wm
${grad6}⡟⣿⡄⠀⠀⠠⣴⢶⣄⠀⡠⣤⠄⢀⠀⠉⢀⠻⡿⡠⢝⠆⠑⡈⠊⢝⡢⣟⡻⣿⠟⢛⡛⣉⡉⠤⡀⠉⠍⢰    ${grad2}  memory:${reset} $memory
${grad6}⣿⣌⢿⣄⠀⣀⠙⢿⣿⣷⣤⣴⣢⣼⣧⠑⠮⣗⠦⣌⡓⠥⣄⠩⢒⠑⠪⣌⠙⡲⢥⣤⣂⢬⣝⠢⠔⡺⢃⡟    ${grad1} 󱫐 uptime :${reset} $uptime
${grad6}⣿⣿⣦⠹⣆⠈⢃⠠⣍⠛⣛⠛⡛⢉⠥⣛⠶⣬⡙⠪⢉⡲⢤⣁⠢⢕⡀⠠⣝⡪⣴⡠⢉⢷⣊⠛⠦⠀⣼⠇    ${grad2} 󱦟 os age:${reset} $(get_os_age)
${grad6}⣿⣿⢻⣷⡌⢦⡑⠪⢆⠹⣢⢕⡪⢕⡢⢌⡛⠮⣝⠣⠺⠇⡲⢭⣗⠾⣿⣦⣍⣛⠶⣝⡳⣷⣿⣿⣷⣾⡟⣼    ${b_yellow}  fw age${reset}: $(hostname) ${reset}
${grad6}⣿⣿⣆⢻⣷⠰⣍⠀⠁⣙⠲⢵⣈⢓⣭⣗⡨⣖⣲⣴⣔⣭⣟⣷⣽⣿⣶⣿⣿⣿⣿⣶⣿⣿⣿⣿⣿⣿⣼⡿    
${grad6}⣿⣿⡻⡄⢻⣷⡙⣷⣦⣌⡛⠶⢿⣷⣮⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⣿⠟⣁⡤⠙⣿⣿⣿⣿⣿⠟⡀    
${grad6}⣿⣿⡄⡙⣄⢻⣿⡎⠻⣿⣿⣿⣷⣾⣿⣿⣿⣟⡻⠿⠿⠿⠿⢛⣛⣭⣤⣴⡖⠚⠃⡠⢃⣿⣿⡿⠛⢡⣾⢱    
${grad6}⣿⠻⣿⡈⡺⣄⡻⣿⣌⢦⣙⠻⢿⣿⣿⣿⣿⣿⣿⣧⡀⠦⣬⣌⣙⣛⣛⣉⣤⡴⢚⣥⣿⠟⣫⣴⢇⣿⠏⢀
${grad6}⣿⣷⣜⢷⡙⣮⡻⢮⠻⣎⢻⣷⣄⠊⠛⡛⠿⢿⣿⣿⣷⡝⣶⣮⣶⣶⣶⣶⣶⡶⠟⣫⣵⣿⣿⡏⣼⠋⢠⣿
${grad6}⣿⣿⣿⣧⣝⠘⢿⣶⣥⣝⠧⠹⢿⣦⡀⠹⣿⣶⣬⣝⡛⠻⢮⣟⣛⣛⠿⢋⣡⣴⣾⣿⣿⣿⡿⠐⠅⢰⣿⣿

EOF

}

case $1 in 
    "--ahegao"|"-a") ahegao;;
    '') normal;;
    *) echo "peler";;

esac
exit 0